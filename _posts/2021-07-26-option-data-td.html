<div>
<span style="word-wrap:break-word" id="msg"></span>	
<br>
Reference List: 
	<br><br>
<span style="word-wrap:break-word" id="reference"></span>
<br>
	
<input onkeyup="if (event.keyCode == 27) this.value = '';
		else if (event.keyCode == 13) {
			event.preventDefault(); 
			submitTicker();
		}"
id="tickerInput" type="text" style="margin-left:10px; margin-right:10px" autocomplete="off" placeholder="Add stock ticker..."> 
  <div style="background-color:tan; padding-left:40px;"><span style="width:70px; display:inline-block;">Symbol</span><span style="width:70px; display:inline-block;">Price</span><span style="width:70px; display:inline-block;">Strike</span><span style="width:70px; display:inline-block;">lastPrice</span><span style="width:50px; display:inline-block;">Type</span><span style="width:70px; display:inline-block;">RET(%)</span><span style="width:70px; display:inline-block;">DIST(%)</span><span style="width:70px; display:inline-block;">Exp(days)</span><span style="width:70px; display:inline-block;">Bid</span><span style="width:70px; display:inline-block;">Ask</span>
</div>
  <ol style="margin-top:0px; height:500px; position:relative; overflow:auto;" id="list"></ol>

<div>

<script>
  //var option_symbols = ['AAPL', 'ABT', 'ADBE', 'AMT', 'AMD', 'AMZN', 'ATVI','BA','BAC','BABA', 'BIDU', 'COP', 'C','COST', 'DIS', 'FB','EA','EBAY','GOOG','GOOGL','HD','INTC','JNJ','MA','MPC','MRVL','MSFT','MU','NVDA','ORCL','PYPL','SHAK','SLB','T','TSM','TWTR','TXN','UBER','V','VLO','WFC','WISH','WMT','XOM']                     
  //var reference = "AAPL,ABT,ADBE,AMT,AMD,AMZN,ATVI,BA,BAC,BABA,BIDU,COP,C,COST,DIS,FB,EA,EBAY,GOOG,GOOGL,HD,INTC,JNJ,MA,MPC,MRVL,MSFT,MU,NVDA,ORCL,PYPL,SHAK,SLB,T,TSM,TWTR,TXN,UBER,V,VLO,WFC,WISH,WMT,XOM";
  	
var option_symbols = ['AMC', 'ABT'];                    
var reference = "AMC,ABT";

D('reference').textContent = reference;
D('tickerInput').value = reference;
D('tickerInput').focus();

submitTicker();
function submitTicker() {
D('list').textContent = "";
var errorString = "";
var allData = {};
	
D('msg').textContent = "Loading...";
option_symbols = D('tickerInput').value.toUpperCase().replaceAll(" ", ",").split(",");
var promises = [];
let expirationDateMax = new Date(Date.now() + 1000*60*60*24*12).toISOString();
var baseUrl = "https://api.tdameritrade.com/v1/marketdata/chains?apikey=PE0HOSE5BENVL20NNFT1XLMMYRQEN50L&symbol=" ;

//******* Fetch data *****
for (let i = 0; i < option_symbols.length; i++) {
	let wholeQuery = baseUrl + option_symbols[i] + "&range=OTM&toDate=" + expirationDateMax;
	promises.push(fetch(wholeQuery).then(function(response) { 
	return response.json(); 
	}).then(function(data) {
		allData[option_symbols[i]] = [];
		allData[option_symbols[i]].push(data);
    		console.log(data); 
    		console.log(option_symbols[i], data.underlyingPrice);
	})//then function(data)
);//promise.push
}// for option_symbols.length 	
	
Promise.all(promises).then(function() {	
   download(JSON.stringify(alldata), 'my-new-file.txt', 'text/plain');	
})
}//submitTicker
	
function D(str) { return document.getElementById(str); }	
	
function download(content, filename, contentType) {
  const a = document.createElement('a');
  const file = new Blob([content], {type: contentType});
  
  a.href= URL.createObjectURL(file);
  a.download = filename;
  a.click();

	URL.revokeObjectURL(a.href);
}
  

</script>
